<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>RequestAnimationFrame</title>
</head>
<body>
	<style>
	  .anim-circle {width: 100px; height: 100px; border-radius: 50%; background-color: #4a4; will-change: transform;}
	</style>
	<div class="anim-circle"></div>
	<p>打开开发者工具 Console 查看动画耗时详情</p>
	<script>
	  if (!Date.now)
	    Date.now = function() { return new Date().getTime();
	  };

	  (function() {
	    'use strict';

	    var vendors = ['webkit', 'moz'];
	    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {
	      var vp = vendors[i];
	      window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];
	      window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame']
	        || window[vp+'CancelRequestAnimationFrame']);
	    }
	    if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {
	      var lastTime = 0;
	      window.requestAnimationFrame = function(callback) {
	        var now = Date.now();
	        var nextTime = Math.max(lastTime + 16, now);
	        return setTimeout(function() {
	         callback(lastTime = nextTime);
	        }, nextTime - now);
	      };
	      window.cancelAnimationFrame = clearTimeout;
	    }
	  }());

	  var circle = document.querySelector('.anim-circle');
	  var left = 0;
	  var timeConsum = 0;
	  var lastTime = Date.now();
	  var countTime = 0;

	  function doTransformAnimation() {
	    if (left > 500) return;

	    var now = Date.now();
	    var prevTime = lastTime;
	    lastTime = now;
	    timeConsum = lastTime - prevTime;
	    countTime += timeConsum;

	    console.log('当前时间戳：' + now + ', 动画执行耗时：' + timeConsum + 'ms' + ', 动画总耗时：' + countTime + 'ms');
	    
	    circle.style.transform = 'translateX(' + left + 'px)';
	    left += 1;
	    window.requestAnimationFrame(doTransformAnimation);
	  }

	  window.requestAnimationFrame(doTransformAnimation);
	</script>
</body>
</html>